<?php 
/**
 * 
 * Single Post Display for Atomic Post Block
 * 
 */

/** @var array $args */

$enable_link = $args['enable_link'];
$job_title = get_field('job_title', get_the_id());

?>
<article <?php post_class( 'atomic-post-wrapper' ); ?>>
	<div class="atomic-post">
		<div class="atomic-post-col-1">
			<div class="featured-image-wrapper">
				<?php if(1 == $enable_link) : ?>
				<a href="<?php the_permalink(); ?>">
				<?php endif; ?>
				<?php echo get_the_post_thumbnail( get_the_id(), 'square', array( 'class' => 'featured-image' ) ); ?>
				<?php if(1 == $enable_link) : ?>
				</a>
				<?php endif; ?>
			</div>
		</div>
		<div class="atomic-post-col-2">
			<div class="content-wrapper">
				<div class="title-wrapper">
					<h3 class="title">
						<?php if(1 == $enable_link) : ?>
						<a href="<?php the_permalink(); ?>">
						<?php endif; ?>
						<?php the_title(); ?>
						<?php if(1 == $enable_link) : ?>
						</a>
						<?php endif; ?>
					</h3>
				</div>
				<?php if ($job_title) : ?>
					<div class="person-job-title-wrapper">
						<span class="person-job-title"><?php echo $job_title;?></span>
					</div>
				<?php endif; ?>
				<div class="terms-wrapper">
					<?php
					$taxes = get_post_taxonomies();
					foreach ( $taxes as $tax ) :
						if ( 'category' !== $tax && 'post_tag' !== $tax && 'post_format' !== $tax ) :
								// print_r( $tax );
								$terms = get_the_terms( get_the_id(), $tax );
							if ( ! empty( $terms ) ) :
							?><ul class="terms<?php echo ' tax-' . $tax; ?>">
										<?php
											foreach ( $terms as $term ) :
												$p_tid   = $term->term_id;
												$p_tname = $term->name;
												$p_tslug = $term->slug;
												$p_turl  = get_term_link( $p_tid );
												?>
											<li class="term tid-<?php echo $p_tid . ' tslug-' . $p_tslug; ?>">
												<?php if(1 == $enable_link) : ?>
												<a href="<?php echo $p_turl; ?>" class="term-link">
												<?php endif; ?>
													<span class="term-text"><?php echo $p_tname; ?></span>
												<?php if(1 == $enable_link) : ?>
												</a>
												<?php endif; ?>
											</li>
												<?php
											endforeach;
										?>
								</ul>
							<?php
							endif;
						endif;
					endforeach;
					?>
				</div>
				<?php if (has_excerpt()) : ?>
					<div class="excerpt-wrapper">
						<div class="excerpt"><?php echo wp_trim_words( get_the_excerpt(), 20 ); ?></div>
					</div>
				<?php
				elseif(get_the_content()) :?>
					<div class="excerpt-wrapper trimmed-content">
						<div class="excerpt"><?php echo wp_trim_words( get_the_content(), 20 ); ?></div>
					</div>
				<?php
				endif;
				$aid         = get_the_author_meta( 'id' );
				$profile_pic = get_field( 'profile_picture', 'user_' . $aid );
				$a_url       = get_author_posts_url( $aid );
				$avatar = get_avatar_url( get_the_author_meta( 'ID' ));
				if(1 == $show_author) :?>
					<div class="author-wrapper">
						<a href="<?php echo $a_url; ?>" class="author-link">
							<div class="avatar-wrapper">
									<picture>
									<?php if ( $profile_pic ) : ?>
										<?php echo bt_load_image_or_svg( $profile_pic ); ?>
									<?php elseif(strpos($avatar, 'blank') == false) : ?>
										<source srcset="<?php print get_avatar_url( $aid, array( 'size' => '51' ) ); ?>" media="(min-width: 992px)"/>
										<img src="<?php print get_avatar_url( $aid, array( 'size' => '40' ) ); ?>"/>
									<?php else : ?>
										<svg class="author-fallback-avatar" fill="none" height="26" viewBox="0 0 709 709" width="26" xmlns="http://www.w3.org/2000/svg"><path d="m0 0h709v709h-709z" fill="#b5121b"/><path d="m633.962 354.626c0 115.165-93.437 208.553-208.713 208.553s-208.713-93.388-208.713-208.553 93.395-208.554 208.672-208.554c115.276 0 208.713 93.347 208.713 208.512z" stroke="#fff" stroke-width=".947999"/><g fill="#fff"><path clip-rule="evenodd" d="m425.998 145.367c-88.474 0-164.084 55-194.65 132.562.372-.041.786-.083 1.282-.083 9.1 0 22.625.62 23.618.62.992 0 13.732-.62 19.771-.62 2.233 0 3.226.414 3.226 1.612 0 .826-.786 1.198-1.613 1.198-1.406 0-2.647.207-5.046.62-5.46.992-7.073 4.422-7.487 11.488-.413 6.446-.413 12.107-.413 43.553v4.257c0 .991.62 1.198 1.199 1.198h85.62c.62 0 1.199-.207 1.199-1.198v-4.257c0-31.487 0-37.107-.414-43.553-.413-6.86-2.026-10.083-8.686-11.488-1.613-.413-5.046-.62-6.866-.62-.786 0-1.613-.413-1.613-1.198 0-1.198.993-1.612 3.226-1.612 9.1 0 21.798.62 22.832.62s13.733-.62 19.813-.62c2.233 0 3.226.414 3.226 1.612 0 .826-.827 1.198-1.613 1.198-1.406 0-2.606.207-5.046.62-5.46.992-7.073 4.422-7.487 11.488-.413 6.446-.413 12.107-.413 43.553v35.496c0 19.38 0 35.289.992 43.802.621 5.826 1.82 10.289 7.859 11.074 2.813.413 7.28.785 9.1.785 1.199 0 1.613.62 1.613 1.199 0 .991-.993 1.611-3.226 1.611-11.085 0-23.825-.62-24.859-.62s-13.732.62-19.771.62c-2.234 0-3.226-.413-3.226-1.611 0-.62.413-1.199 1.613-1.199 1.82 0 4.219-.413 6.039-.785 4.053-.826 5.046-5.248 5.873-11.074.993-8.471.993-24.422.993-43.802v-21.157c0-.826-.579-1.198-1.2-1.198h-85.619c-.621 0-1.2.206-1.2 1.198v21.157c0 19.38 0 35.289.993 43.802.62 5.826 1.82 10.289 7.859 11.074 2.854.413 7.279.785 9.099.785 1.2 0 1.614.62 1.614 1.199 0 .991-.993 1.611-3.227 1.611-11.085 0-23.824-.62-24.817-.62s-17.662.62-23.742.62c-.538 0-.951 0-1.323-.083 30.442 77.81 106.176 132.934 194.774 132.934 115.441 0 209.126-93.595 209.126-208.925 0-115.331-93.561-208.843-209.002-208.843zm94.595 277.314c-1.2 3.843-1.613 4.215-5.253 5.826-8.066 3.223-23.411 4.628-36.358 4.628-30.277 0-50.668-7.479-66.634-21.776-19.605-17.562-24.445-40.538-24.445-59.711 0-13.512 4.633-37.108 22.625-55.083 12.119-12.107 30.484-21.57 61.588-21.57 8.066 0 19.399.62 29.285 2.438 7.693 1.405 14.146 2.603 20.598 3.017 2.234.206 2.647.991 2.647 2.231 0 1.612-.62 4.05-1.034 11.281-.413 6.653-.413 17.727-.62 20.785-.207 3.017-.621 4.256-1.82 4.256-1.406 0-1.613-1.405-1.613-4.256 0-7.851-3.227-16.116-8.48-20.578-7.072-6.033-22.625-11.488-40.369-11.488-26.844 0-39.377 7.851-46.45 14.711-14.724 14.132-18.157 32.066-18.157 52.644 0 38.554 29.697 73.843 72.879 73.843 15.139 0 27.051-1.818 35.158-10.082 4.219-4.463 6.866-13.306 7.445-16.943.414-2.231.828-3.016 2.027-3.016 1.034 0 1.406 1.405 1.406 3.016 0 1.405-2.44 18.967-4.425 25.827zm74.534-141.322c-1.654 0-3.061.248-5.873.702-6.37 1.157-8.231 5.166-8.728 13.43-.455 7.521-.455 14.132-.455 50.826v56.488c0 38.14 0 52.727-7.072 69.421-4.964 11.777-15.304 22.851-34.414 36.033-3.061 2.108-6.825 4.711-9.182 5.868-.455.248-.951.455-1.655.455-.703 0-1.654-.455-1.654-1.405 0-1.405 1.199-2.108 3.309-3.513 2.812-1.653 6.121-4.463 8.231-6.57 15.304-15.537 22.625-28.017 22.625-88.719v-68.016c0-36.695 0-43.306-.455-50.827-.455-8.016-2.358-11.777-10.134-13.429-1.902-.455-5.914-.703-8.024-.703-.951 0-1.903-.454-1.903-1.405 0-1.405 1.159-1.901 3.764-1.901 10.589 0 25.438.703 26.638.703 1.199 0 16.007-.703 23.08-.703 2.564 0 3.763.455 3.763 1.901 0 .951-.951 1.405-1.902 1.405" fill-rule="evenodd"/><path clip-rule="evenodd" d="m247.401 292.764c-.414-6.86-2.027-10.083-8.686-11.488-1.613-.413-5.874-.62-7.693-.62-.249 0-.497-.041-.704-.124-8.686 22.934-13.442 47.769-13.442 73.761 0 25.991 4.715 50.495 13.277 73.347.207-.083.455-.083.744-.083 1.82 0 8.19-.413 10.01-.826 4.054-.827 5.046-5.248 5.874-11.075.992-8.471.992-24.421.992-43.76v-35.496c0-31.487 0-37.107-.413-43.553" fill-rule="evenodd"/><path d="m226.84 427.515c-2.027 0-5.046-.207-8.065-1.199-4.261-1.198-10.093-4.421-17.373-22.396-12.325-30.661-44.009-113.967-47.07-121.612-2.44-6.239-3.226-7.272-4.425-7.272-1.2 0-2.027 1.198-4.426 7.851l-45.8292 125.289c-3.6399 10.083-7.652 17.727-16.9585 18.967-1.6131.206-4.4257.413-5.8734.413-.9927 0-1.8199.413-1.8199 1.198 0 1.199 1.1995 1.612 3.8467 1.612 9.4719 0 20.5983-.62 22.8323-.62 2.233 0 10.919.62 15.758.62 1.82 0 3.02-.413 3.02-1.612 0-.826-.621-1.198-2.027-1.198h-2.027c-3.433 0-7.652-1.818-7.652-5.826 0-3.637.993-8.471 2.813-13.513l12.119-35.702c.414-.992.993-1.612 2.027-1.612h43.43c.993 0 1.406.413 1.82 1.199l18.778 49.628c1.2 3.223 0 5.041-1.199 5.454-.786.207-1.406.62-1.406 1.405 0 1.198 2.233 1.198 6.038 1.405 13.939.413 28.664.413 31.725.413 2.234 0 4.012-.413 4.012-1.611 0-.992-.786-1.199-2.026-1.199m-60.389-63.925h-38.591c-.62 0-.993-.413-.62-1.405l17.785-54.463c.993-3.016 2.027-3.016 3.02 0l19.192 54.463c.207.826.207 1.405-.786 1.405z"/></g></svg>
									<?php endif; ?>
									</picture>
							</div>
							<div class="author-name-wrapper">
								<div class="author-name"><?php echo get_author_name(); ?></div>
							</div>
						</a>
					</div>
				<?php endif; ?>
			</div>
		</div>
	</div>
</article>
